{{/* =========================
   Slack Templates (Alertmanager)
   - slack.title
   - slack.text
   IMPORTANT:
     - NO usar {{- o -}} porque destruye los saltos de lÃ­nea
   ========================= */}}

{{ define "slack.title" }}
{{ $status := .Status | toUpper }}
{{ $emoji := "âœ…" }}
{{ if eq $status "FIRING" }}{{ $emoji = "ðŸš¨" }}{{ end }}

{{ $sev := "UNKNOWN" }}
{{ if (index .CommonLabels "severity") }}{{ $sev = (index .CommonLabels "severity") | toUpper }}{{ end }}

{{ $name := "Alert" }}
{{ if (index .CommonLabels "alertname") }}{{ $name = (index .CommonLabels "alertname") }}{{ end }}

{{ $emoji }} {{ $status }} | {{ $sev }} | {{ $name }}
{{ end }}


{{ define "slack.text" }}
{{/* Fallbacks: si no hay annotations, permitimos summary/description como labels (amtool) */}}
{{ $summary := "" }}
{{ if (index .CommonAnnotations "summary") }}
{{ $summary = index .CommonAnnotations "summary" }}
{{ else if (index .CommonLabels "summary") }}
{{ $summary = index .CommonLabels "summary" }}
{{ end }}

{{ $desc := "" }}
{{ if (index .CommonAnnotations "description") }}
{{ $desc = index .CommonAnnotations "description" }}
{{ else if (index .CommonLabels "description") }}
{{ $desc = index .CommonLabels "description" }}
{{ end }}

{{ $runbook := "" }}
{{ if (index .CommonAnnotations "runbook_url") }}{{ $runbook = index .CommonAnnotations "runbook_url" }}{{ end }}

{{/* -------- Summary -------- */}}
*Summary:* {{ if $summary }}{{ $summary }}{{ else }}_(no summary)_{{ end }}

{{ "\n" }}
{{ "\n" }}

{{/* -------- Description -------- */}}
{{ if $desc }}
*Description:*
{{ $desc }}

{{ "\n" }}
{{ end }}

{{/* -------- Key labels -------- */}}
*Key labels:*
{{ if (index .CommonLabels "namespace") }}â€¢ *namespace:* `{{ index .CommonLabels "namespace" }}`{{ end }}
{{ "\n" }}
{{ if (index .CommonLabels "pod") }}â€¢ *pod:* `{{ index .CommonLabels "pod" }}`{{ end }}
{{ "\n" }}
{{ if (index .CommonLabels "container") }}â€¢ *container:* `{{ index .CommonLabels "container" }}`{{ end }}
{{ "\n" }}
{{ if (index .CommonLabels "job") }}â€¢ *job:* `{{ index .CommonLabels "job" }}`{{ end }}
{{ "\n" }}
{{ if (index .CommonLabels "instance") }}â€¢ *instance:* `{{ index .CommonLabels "instance" }}`{{ end }}

{{ "\n" }}
{{ "\n" }}

{{/* -------- Links -------- */}}
*Links:*
{{ if $runbook }}â€¢ ðŸ“˜ <{{ $runbook }}|Runbook>{{ "\n" }}{{ end }}
{{ if .ExternalURL }}â€¢ ðŸ”— <{{ .ExternalURL }}|Alertmanager>{{ end }}
{{ end }}
