{{/* =========================================================
   Slack Templates (Alertmanager)
   - slack.title
   - slack.text
   Compatible con Alertmanager (sin sprig).
   ========================================================= */}}

{{ define "slack.title" }}
{{- $status := .Status | toUpper -}}
{{- $sev := (index .CommonLabels "severity") -}}
{{- $name := (index .CommonLabels "alertname") -}}
{{- if eq .Status "firing" -}}ðŸš¨{{- else -}}âœ…{{- end -}} {{ $status }}{{- if $sev -}} | {{ $sev | toUpper }}{{- end -}}{{- if $name -}} | {{ $name }}{{- end -}}
{{ end }}

{{ define "slack.text" }}
{{- $summary := (index .CommonAnnotations "summary") -}}
{{- $desc := (index .CommonAnnotations "description") -}}
{{- $runbook := (index .CommonAnnotations "runbook_url") -}}
{{- $grafana := (index .CommonAnnotations "grafana_url") -}}

*Summary:* {{ if $summary }}{{ $summary }}{{ else }}_(no summary annotation)_{{ end }}
{{- if $desc }}
*Description:* {{ $desc }}
{{- end }}

*Key labels:*
{{- with (index .CommonLabels "namespace") }}â€¢ *namespace:* `{{ . }}`{{ end }}
{{- with (index .CommonLabels "job") }}â€¢ *job:* `{{ . }}`{{ end }}
{{- with (index .CommonLabels "instance") }}â€¢ *instance:* `{{ . }}`{{ end }}
{{- with (index .CommonLabels "pod") }}â€¢ *pod:* `{{ . }}`{{ end }}
{{- with (index .CommonLabels "service") }}â€¢ *service:* `{{ . }}`{{ end }}
{{- with (index .CommonLabels "controller") }}â€¢ *controller:* `{{ . }}`{{ end }}

{{- if or $runbook $grafana .ExternalURL }}

*Links:*
{{- with $runbook }}â€¢ ðŸ“˜ <{{ . }}|Runbook>{{ end }}
{{- with $grafana }}â€¢ ðŸ“ˆ <{{ . }}|Grafana>{{ end }}
{{- with .ExternalURL }}â€¢ ðŸ”— <{{ . }}|Alertmanager>{{ end }}
{{- end }}
{{ end }}
