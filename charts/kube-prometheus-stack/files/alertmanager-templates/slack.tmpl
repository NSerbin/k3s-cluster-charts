{{/* =========================
   Slack Templates (Alertmanager)
   - slack.title
   - slack.text
   NOTES:
     - NO usar {{- o -}} (te rompe el formato en Slack)
   ========================= */}}

{{ define "slack.title" }}
{{ $status := .Status | toUpper }}
{{ $emoji := "‚úÖ" }}
{{ if eq $status "FIRING" }}{{ $emoji = "üö®" }}{{ end }}

{{ $sev := "UNKNOWN" }}
{{ if (index .CommonLabels "severity") }}{{ $sev = (index .CommonLabels "severity") | toUpper }}{{ end }}

{{ $name := "Alert" }}
{{ if (index .CommonLabels "alertname") }}{{ $name = (index .CommonLabels "alertname") }}{{ end }}

{{ $emoji }} {{ $status }} | {{ $sev }} | {{ $name }}
{{ end }}


{{ define "slack.text" }}
{{/* Fallbacks por si el alert viene ‚Äúplano‚Äù (amtool) */}}
{{ $summary := "" }}
{{ if (index .CommonAnnotations "summary") }}
{{ $summary = index .CommonAnnotations "summary" }}
{{ else if (index .CommonLabels "summary") }}
{{ $summary = index .CommonLabels "summary" }}
{{ end }}

{{ $desc := "" }}
{{ if (index .CommonAnnotations "description") }}
{{ $desc = index .CommonAnnotations "description" }}
{{ else if (index .CommonLabels "description") }}
{{ $desc = index .CommonLabels "description" }}
{{ end }}

{{ $runbook := "" }}
{{ if (index .CommonAnnotations "runbook_url") }}{{ $runbook = index .CommonAnnotations "runbook_url" }}{{ end }}

*Summary:* {{ if $summary }}{{ $summary }}{{ else }}_(no summary)_{{ end }}

{{ if $desc }}
*Description:*
{{ $desc }}
{{ end }}

*Key labels:*
{{ if (index .CommonLabels "namespace") }}‚Ä¢ *namespace:* `{{ index .CommonLabels "namespace" }}`{{ end }}
{{ if (index .CommonLabels "pod") }}
‚Ä¢ *pod:* `{{ index .CommonLabels "pod" }}`
{{ end }}
{{ if (index .CommonLabels "container") }}
‚Ä¢ *container:* `{{ index .CommonLabels "container" }}`
{{ end }}
{{ if (index .CommonLabels "job") }}
‚Ä¢ *job:* `{{ index .CommonLabels "job" }}`
{{ end }}
{{ if (index .CommonLabels "instance") }}
‚Ä¢ *instance:* `{{ index .CommonLabels "instance" }}`
{{ end }}

*Links:*
{{ if $runbook }}‚Ä¢ üìò <{{ $runbook }}|Runbook>{{ end }}
{{ if and $runbook .ExternalURL }}
{{ end }}
{{ if .ExternalURL }}‚Ä¢ üîó <{{ .ExternalURL }}|Alertmanager>{{ end }}
{{ end }}
