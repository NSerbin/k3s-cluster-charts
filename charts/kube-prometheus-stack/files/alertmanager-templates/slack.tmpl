{{- define "slack.text" -}}
{{- $summary := "" -}}{{- with (index .CommonAnnotations "summary") -}}{{- $summary = . -}}{{- end -}}
{{- $desc := "" -}}{{- with (index .CommonAnnotations "description") -}}{{- $desc = . -}}{{- end -}}
{{- $runbook := "" -}}{{- with (index .CommonAnnotations "runbook_url") -}}{{- $runbook = . -}}{{- end -}}
{{- $grafana := "" -}}{{- with (index .CommonAnnotations "grafana_url") -}}{{- $grafana = . -}}{{- end -}}

{{- $sep := "----------------------------------------" -}}

{{- /* Header */ -}}
{{ $sep }}
{{- if $summary -}}
*Summary:* {{ $summary }}
{{- else -}}
*Summary:* _(no summary annotation)_
{{- end -}}

{{- if $desc -}}
{{ "\n" }}*Description:*{{ "\n" }}{{ $desc }}
{{- end -}}

{{ "\n" }}*Key labels:*{{ "\n" -}}
{{- with (index .CommonLabels "namespace") -}}â€¢ *namespace:* `{{ . }}`{{ "\n" }}{{- end -}}
{{- with (index .CommonLabels "job") -}}â€¢ *job:* `{{ . }}`{{ "\n" }}{{- end -}}
{{- with (index .CommonLabels "instance") -}}â€¢ *instance:* `{{ . }}`{{ "\n" }}{{- end -}}
{{- with (index .CommonLabels "pod") -}}â€¢ *pod:* `{{ . }}`{{ "\n" }}{{- end -}}
{{- with (index .CommonLabels "service") -}}â€¢ *service:* `{{ . }}`{{ "\n" }}{{- end -}}
{{- with (index .CommonLabels "controller") -}}â€¢ *controller:* `{{ . }}`{{ "\n" }}{{- end -}}

{{- /* Other labels */ -}}
{{- $extra := "" -}}
{{- range .CommonLabels.SortedPairs -}}
{{- if and
    (ne .Name "alertname")
    (ne .Name "severity")
    (ne .Name "namespace")
    (ne .Name "job")
    (ne .Name "instance")
    (ne .Name "pod")
    (ne .Name "service")
    (ne .Name "controller")
  -}}
{{- $extra = printf "%sâ€¢ *%s:* `%s`\n" $extra .Name .Value -}}
{{- end -}}
{{- end -}}
{{- if $extra -}}
{{ "\n" }}*Other labels:*{{ "\n" }}{{ $extra -}}
{{- end -}}

{{- /* Links */ -}}
{{- if or $runbook $grafana .ExternalURL -}}
{{ $sep }}
*Links:*
{{- if $runbook }}{{ "\n" }}â€¢ <{{ $runbook }}|ðŸ“˜ Runbook>{{- end -}}
{{- if $grafana }}{{ "\n" }}â€¢ <{{ $grafana }}|ðŸ“ˆ Grafana>{{- end -}}
{{- if .ExternalURL }}{{ "\n" }}â€¢ <{{ .ExternalURL }}|ðŸ”— Alertmanager>{{- end -}}
{{- end -}}
{{- end -}}
