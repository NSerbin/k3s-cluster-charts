{{/* =========================================================
   Slack Templates for Alertmanager
   Templates:
     - slack.title
     - slack.text
   Compatible with Alertmanager v0.30
   ========================================================= */}}

{{/* ========================
   TITLE
   ======================== */}}
{{ define "slack.title" }}
{{ if eq .Status "firing" }}ðŸš¨ FIRING{{ else }}âœ… RESOLVED{{ end }}
 | {{ with (index .CommonLabels "severity") }}{{ . | toUpper }}{{ else }}UNKNOWN{{ end }}
 | {{ with (index .CommonLabels "alertname") }}{{ . }}{{ else }}Alert{{ end }}
{{ end }}


{{/* ========================
   BODY
   ======================== */}}
{{ define "slack.text" }}

{{- $summary := (index .CommonAnnotations "summary") -}}
{{- $description := (index .CommonAnnotations "description") -}}
{{- $runbook := (index .CommonAnnotations "runbook_url") -}}

*Summary:*
```{{ if $summary }}{{ $summary }}{{ else }}(no summary annotation){{ end }}

{{ if $description }}
*Description:*
```{}

*Key labels:*
â€¢ *namespace:* `{{ index .CommonLabels "namespace" }}`
{{ with (index .CommonLabels "job") }}
â€¢ *job:* `{{ . }}`{{ end }}
{{ with (index .CommonLabels "instance") }}
â€¢ *instance:* `{{ . }}`{{ end }}
{{ with (index .CommonLabels "pod") }}
â€¢ *pod:* `{{ . }}`{{ end }}
{{ with (index .CommonLabels "service") }}
â€¢ *service:* `{{ . }}`{{ end }}
{{ with (index .CommonLabels "controller") }}
â€¢ *controller:* `{{ . }}`{{ end }}

{{- /* Other labels (filtered) */ -}}
{{- $extra := "" -}}
{{- range .CommonLabels.SortedPairs -}}
{{- if and
    (ne .Name "alertname")
    (ne .Name "severity")
    (ne .Name "namespace")
    (ne .Name "job")
    (ne .Name "instance")
    (ne .Name "pod")
    (ne .Name "service")
    (ne .Name "controller")
  -}}
{{- $extra = printf "%sâ€¢ *%s:* `%s`\n" $extra .Name .Value -}}
{{- end -}}
{{- end -}}
{{- if $extra }}

*Other labels:*
{{ $extra }}
{{- end }}

*Links:*
{{ if $runbook }}â€¢ ðŸ“˜ <{{ $runbook }}|Runbook>{{ end }}
{{ if .ExternalURL }}â€¢ ðŸ”— <{{ .ExternalURL }}|Alertmanager>{{ end }}

{{ end }}
