{{/* =========================================================
   Alertmanager Slack Templates
   Compatible con Alertmanager v0.30+
   ========================================================= */}}

{{ define "slack.title" -}}
{{ if eq .Status "firing" }}ðŸš¨ FIRING {{ else }}âœ… RESOLVED {{ end }} |
{{ with index .CommonLabels "severity" }}{{ . | upper }}{{ else }}UNKNOWN{{ end }} |
{{ with index .CommonLabels "alertname" }}{{ . }}{{ else }}Alert{{ end }}
{{- end }}

{{ define "slack.text" -}}

{{/* ---------- SUMMARY ---------- */}}
{{ with index .CommonAnnotations "summary" -}}
*Summary:* {{ . }}
{{- end }}

{{/* ---------- DESCRIPTION ---------- */}}
{{ with index .CommonAnnotations "description" }}

*Description:*
{{ . }}
{{- end }}

{{/* ---------- KEY LABELS ---------- */}}
*Key labels:*
{{ with index .CommonLabels "namespace" }}â€¢ *namespace:* `{{ . }}`{{ end }}
{{ with index .CommonLabels "job" }}â€¢ *job:* `{{ . }}`{{ end }}
{{ with index .CommonLabels "instance" }}â€¢ *instance:* `{{ . }}`{{ end }}
{{ with index .CommonLabels "pod" }}â€¢ *pod:* `{{ . }}`{{ end }}
{{ with index .CommonLabels "service" }}â€¢ *service:* `{{ . }}`{{ end }}

{{/* ---------- OTHER LABELS ---------- */}}
{{ $printed := false }}
{{ range .CommonLabels.SortedPairs }}
{{ if and
  (ne .Name "alertname")
  (ne .Name "severity")
  (ne .Name "namespace")
  (ne .Name "job")
  (ne .Name "instance")
  (ne .Name "pod")
  (ne .Name "service")
}}
{{ if not $printed }}*Other labels:*{{ $printed = true }}{{ end }}
â€¢ *{{ .Name }}:* `{{ .Value }}`
{{ end }}
{{ end }}

{{/* ---------- LINKS ---------- */}}
{{ if or
  (index .CommonAnnotations "runbook_url")
  (index .CommonAnnotations "grafana_url")
  .ExternalURL
}}
*Links:*
{{ with index .CommonAnnotations "runbook_url" }}â€¢ ðŸ“˜ <{{ . }}|Runbook>{{ end }}
{{ with index .CommonAnnotations "grafana_url" }}â€¢ ðŸ“ˆ <{{ . }}|Grafana>{{ end }}
{{ with .ExternalURL }}â€¢ ðŸ”— <{{ . }}|Alertmanager>{{ end }}
{{ end }}

{{- end }}
