{{/* =========================================================
   Alertmanager Telegram Templates (HTML)
   - telegram.title
   - telegram.text
   Compatible con Alertmanager v0.30+
   ========================================================= */}}

{{ define "telegram.title" -}}
{{ if eq .Status "firing" }}ðŸš¨ FIRING{{ else }}âœ… RESOLVED{{ end }} |
{{ with index .CommonLabels "severity" }}{{ . | upper }}{{ else }}UNKNOWN{{ end }} |
{{ with index .CommonLabels "alertname" }}{{ . }}{{ else }}Alert{{ end }}
{{- end }}

{{ define "telegram.text" -}}
<b>{{ template "telegram.title" . }}</b>

{{ with index .CommonAnnotations "summary" }}
<b>Summary:</b> {{ . }}
{{ end }}

{{ with index .CommonAnnotations "description" }}
<b>Description:</b>
{{ . }}
{{ end }}

<b>Key labels:</b>
{{ with index .CommonLabels "namespace" }}â€¢ <b>namespace</b>: <code>{{ . }}</code>{{ end }}
{{ with index .CommonLabels "job" }}â€¢ <b>job</b>: <code>{{ . }}</code>{{ end }}
{{ with index .CommonLabels "instance" }}â€¢ <b>instance</b>: <code>{{ . }}</code>{{ end }}
{{ with index .CommonLabels "pod" }}â€¢ <b>pod</b>: <code>{{ . }}</code>{{ end }}
{{ with index .CommonLabels "service" }}â€¢ <b>service</b>: <code>{{ . }}</code>{{ end }}

{{ $printed := false }}
{{ range .CommonLabels.SortedPairs }}
{{ if and
  (ne .Name "alertname")
  (ne .Name "severity")
  (ne .Name "namespace")
  (ne .Name "job")
  (ne .Name "instance")
  (ne .Name "pod")
  (ne .Name "service")
}}
{{ if not $printed }}<b>Other labels:</b>{{ $printed = true }}{{ end }}
â€¢ <b>{{ .Name }}</b>: <code>{{ .Value }}</code>
{{ end }}
{{ end }}

{{ if or (index .CommonAnnotations "runbook_url") (index .CommonAnnotations "grafana_url") .ExternalURL }}
<b>Links:</b>
{{ with index .CommonAnnotations "runbook_url" }}â€¢ ðŸ“˜ <a href="{{ . }}">Runbook</a>{{ end }}
{{ with index .CommonAnnotations "grafana_url" }}â€¢ ðŸ“ˆ <a href="{{ . }}">Grafana</a>{{ end }}
{{ with .ExternalURL }}â€¢ ðŸ”— <a href="{{ . }}">Alertmanager</a>{{ end }}
{{ end }}
{{- end }}
