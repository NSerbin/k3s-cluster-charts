{{/* =========================================================
   Telegram Templates (Alertmanager)
   Usar con telegram_configs (parse_mode: HTML)
   - telegram.title
   - telegram.message
   Sin sprig. Usar: toUpper, printf, index, range, with, if.
   ========================================================= */}}

{{ define "telegram.title" }}
{{ if eq .Status "firing" }}ðŸš¨ FIRING{{ else }}âœ… RESOLVED{{ end }} | {{ with index .CommonLabels "severity" }}{{ . | toUpper }}{{ else }}UNKNOWN{{ end }} | {{ with index .CommonLabels "alertname" }}{{ . }}{{ else }}Alert{{ end }}
{{ end }}

{{ define "telegram.message" }}
<b>{{ template "telegram.title" . }}</b>

<b>Summary:</b>
{{ with index .CommonAnnotations "summary" }}{{ . }}{{ else }}(no summary annotation){{ end }}

{{ with index .CommonAnnotations "description" }}
<b>Description:</b>
{{ . }}
{{ end }}

<b>Key labels:</b>
{{ with index .CommonLabels "namespace" }}â€¢ <b>namespace</b>: <code>{{ . }}</code>{{ end }}
{{ with index .CommonLabels "job" }}â€¢ <b>job</b>: <code>{{ . }}</code>{{ end }}
{{ with index .CommonLabels "instance" }}â€¢ <b>instance</b>: <code>{{ . }}</code>{{ end }}
{{ with index .CommonLabels "pod" }}â€¢ <b>pod</b>: <code>{{ . }}</code>{{ end }}
{{ with index .CommonLabels "service" }}â€¢ <b>service</b>: <code>{{ . }}</code>{{ end }}
{{ with index .CommonLabels "controller" }}â€¢ <b>controller</b>: <code>{{ . }}</code>{{ end }}

{{ $runbook := index .CommonAnnotations "runbook_url" }}
{{ $grafana := index .CommonAnnotations "grafana_url" }}
{{ if or $runbook $grafana .ExternalURL }}

<b>Links:</b>
{{ with $runbook }}â€¢ ðŸ“˜ {{ . }}{{ end }}
{{ with $grafana }}â€¢ ðŸ“ˆ {{ . }}{{ end }}
{{ with .ExternalURL }}â€¢ ðŸ”— {{ . }}{{ end }}
{{ end }}
{{ end }}
