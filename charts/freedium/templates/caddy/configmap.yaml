apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "freedium.fullname" . }}-caddy
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "freedium.labels" . | nindent 4 }}
data:
  Caddyfile: |
    {
      auto_https off
      log {
        output stdout
        level {{ .Values.caddy.logLevel | default "INFO" }}
      }
    }

    :{{ .Values.caddy.port }} {
      encode gzip zstd

      # ✅ Static assets
      handle_path /static/* {
        root * /static
        file_server
      }

      # ✅ (Opcional) servir estáticos que están en raíz (si tu HTML los pide así)
      handle /favicon.ico {
        root * /static
        file_server
      }
      handle /robots.txt {
        root * /static
        file_server
      }
      handle /site.webmanifest {
        root * /static
        file_server
      }

      # Todo lo demás al backend
      handle {
        reverse_proxy 127.0.0.1:7080
      }
    }

